<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Update Role | Ullr Systems</title>
  <link rel="stylesheet" href="mainmenu.css">
</head>
<body>
  <!-- Header -->
  <header class="header-bar">
    <h1 class="brand">
      <span class="ullr">Ullr</span> <span class="systems">Systems</span>
    </h1>
  </header>

  <!-- Layout Container -->
  <div class="layout-container">
    <!-- Sidebar -->
<aside class="sidebar">
  <nav class="main-menu">
    <ul>
      <li><a href="MainMenu.html">Inventory</a></li>
      <li><a href="Order.html">Order</a></li>
      <li><a href="Alerts.html">Alerts</a></li>
      <li><a href="#" id="manageAccountsLink">Manage Accounts</a></li>
      <li><a href="#" id="manageFridgesLink">Manage Fridges</a></li>
      <li><a href="#" id="reportsLink">Reports</a></li>
      <li><a href="#" id="createAccountLink">Create Account</a></li>
       <li><a href="#" id="logoutLink">Logout</a></li>
    </ul>
  </nav>
</aside>


    <!-- Main Content -->
    <main class="content-area">
      <h2>Update Role</h2>
      <form id="updateRoleForm" method="POST" action="updateRole" class="update-form">
        <div class="form-group">
          <label for="username">Select User:</label>
          <select id="username" name="username" class="form-select">
            <!-- Populated by JS -->
          </select>
        </div>

        <div class="form-group">
          <label for="role">New Role:</label>
          <select id="role" name="role" class="form-select">
            <option value="1">Delivery Driver</option>
            <option value="2">Head Chef</option>
            <option value="3">Admin</option>
          </select>
        </div>

        <button type="submit" class="btn btn-success">Update Role</button>
      </form>
      <div id="message" class="message"></div>
    </main>
  </div>

  <script>
    // Load user list for the drop-down
    async function loadUserList() {
      try {
        const response = await fetch('/UllrSystems/getAllUsers');
        if (!response.ok) {
          throw new Error('Failed to fetch user list');
        }
        const data = await response.json();
        const userSelect = document.getElementById('username');

        userSelect.innerHTML = '';
        data.users.forEach(u => {
          const option = document.createElement('option');
          option.value = u;
          option.textContent = u;
          userSelect.appendChild(option);
        });
      } catch (error) {
        console.error(error);
        const messageDiv = document.getElementById('message');
        messageDiv.textContent = 'Error loading users';
        messageDiv.classList.add('error');
      }
    }

    // Handle form submission
    document.getElementById('updateRoleForm').addEventListener('submit', async function(e) {
      e.preventDefault();
      const form = this;
      const username = form.username.value;
      const role = form.role.value;

      const urlEncodedData = new URLSearchParams();
      urlEncodedData.append('username', username);
      urlEncodedData.append('role', role);

      try {
        const response = await fetch('/UllrSystems/updateRole', {
          method: 'POST',
          body: urlEncodedData,
          headers: {
            'Content-Type': 'application/x-www-form-urlencoded'
          }
        });

        if (!response.ok) {
          throw new Error('Failed to update role.');
        }

        const result = await response.json();
        const messageDiv = document.getElementById('message');

        if (result.success) {
          messageDiv.classList.remove('error');
          messageDiv.classList.add('success');
          messageDiv.textContent = result.message;
          form.reset();
        } else {
          messageDiv.classList.remove('success');
          messageDiv.classList.add('error');
          messageDiv.textContent = result.message;
        }
      } catch (error) {
        console.error(error);
        const messageDiv = document.getElementById('message');
        messageDiv.classList.remove('success');
        messageDiv.classList.add('error');
        messageDiv.textContent = 'Error updating role.';
      }
    });

    window.addEventListener('DOMContentLoaded', loadUserList);
  </script>
    <!-- Add the script BELOW so it sees your IDs -->
  <script src="roleCheck.js"></script>
  <script src="logout.js"></script>
</body>
</html>
